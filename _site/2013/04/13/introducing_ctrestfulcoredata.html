<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Sparrow-labs.github.io by Sparrow-Labs</title>

    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
</head>

<body>
    <div class="wrapper">
        <section>
            <article>
                <h1>Introducing SLRESTfulCoreDate</h1>

<p>Today I would like to introduce one of our Open Source Frameworks to you: SLRESTfulCoreData. In a nutshell, SLRESTfulCoreData lets you tie a REST API of a webservice easily to your CoreData model. By default SLRESTfulCoreData maps rails conventions (API communicating with JSON objects with underscored attributes and underscored URLs) into objc conventions. Everything is customizable and integration of other conventions is possible. I think the best approach to explain SLRESTfulCoreData is by example. So let&#39;s implement the <a href="http://developer.github.com">Github API</a> in objc __ <em>real</em> __ quick:</p>

<h2>Basic setup</h2>

<p>The inital project setup is an empty Xcode project with the following dependencies:</p>

<ul>
<li><a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a>: Everyones favorite networking library which I guess I don&#39;t have to introduce here.</li>
<li><a href="https://github.com/ebf/SLRESTfulCoreData">SLRESTfulCoreData</a></li>
<li><a href="https://github.com/ebf/CTDataStoreManager">CTDataStoreManager</a>: An <code>NSObject</code> subclass which implements a CoreData stack with 2 <code>NSManagedObjectContexts</code>. One main thread context and one background thread context. <code>CTDataStoreManager</code> keeps these contexts always in sync by merging changes automatically. A blog post about <code>CTDataStoreManager</code> will be coming in the future. The only thing you need to know right now is that we introduce a subclass <code>GHDataStoreManager</code> of <code>CTDataStoreManager</code> which will manage a CoreData stack for our GithubAPI with the following interface:</li>
</ul>
<div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">GHDataStoreManager</span> : <span class="nc">CTDataStoreManager</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSManagedObjectModel</span> <span class="o">*</span><span class="n">managedObjectModel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSPersistentStoreCoordinator</span> <span class="o">*</span><span class="n">persistentStoreCoordinator</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSManagedObjectContext</span> <span class="o">*</span><span class="n">mainThreadContext</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSManagedObjectContext</span> <span class="o">*</span><span class="n">backgroundThreadContext</span><span class="p">;</span>

<span class="k">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">sharedInstance</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre></div>
<p>Next, SLRESTfulCoreData needs an object which handles network communications. This has been abstracted with the following protocol:</p>
<div class="highlight"><pre><code class="objective-c"><span class="err">@</span><span class="n">protocol</span><span class="p">(</span><span class="n">SLRESTfulCoreDataBackgroundQueue</span><span class="p">)</span>

<span class="o">+</span> <span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SLRESTfulCoreDataBackgroundQueue</span><span class="o">&gt;</span><span class="p">)</span><span class="n">sharedQueue</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">getRequestToURL:</span><span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">URL</span>
      <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="kt">id</span> <span class="n">JSONObject</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">deleteRequestToURL:</span><span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">URL</span>
         <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">postJSONObject:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">JSONObject</span>
                 <span class="nf">toURL:</span><span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">URL</span>
     <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="kt">id</span> <span class="n">JSONObject</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">putJSONObject:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">JSONObject</span>
                <span class="nf">toURL:</span><span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">URL</span>
    <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="kt">id</span> <span class="n">JSONObject</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre></div>
<p>This is super fast implemented thanks to AFNetworking in the <code>GHBackgroundQueue</code> class. Next we implement an initializer which sets up our SLRESTfulCoreData configuration:</p>
<div class="highlight"><pre><code class="objective-c"><span class="n">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span>
<span class="kt">void</span> <span class="n">GHInitializeSLRESTfulCoreData</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="err">@</span><span class="n">autoreleasepool</span> <span class="p">{</span>
        <span class="c1">// register a default background queue</span>
        <span class="p">[</span><span class="n">NSManagedObject</span> <span class="nl">setDefaultBackgroundQueue:</span><span class="p">[</span><span class="n">GHBackgroundQueue</span> <span class="n">sharedInstance</span><span class="p">]];</span>

        <span class="c1">// register default main and background thread context. SLRESTfulCoreData is designed to not block the main thread in any way. Any changes are therefore performed on the background thread context.</span>
        <span class="p">[</span><span class="n">NSManagedObject</span> <span class="nl">registerDefaultBackgroundThreadManagedObjectContextWithAction:</span><span class="o">^</span><span class="n">NSManagedObjectContext</span> <span class="o">*</span><span class="p">{</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">GHDataStoreManager</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">backgroundThreadContext</span><span class="p">;</span>
        <span class="p">}];</span>

        <span class="p">[</span><span class="n">NSManagedObject</span> <span class="nl">registerDefaultMainThreadManagedObjectContextWithAction:</span><span class="o">^</span><span class="n">NSManagedObjectContext</span> <span class="o">*</span><span class="p">{</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">GHDataStoreManager</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">mainThreadContext</span><span class="p">;</span>
        <span class="p">}];</span>

        <span class="c1">// SLObjectConverter encapsulates conversion between JSON objects and NSManagedObjects. Each NSManagedObject subclass receives its own instance and we can register global default values like:</span>
        <span class="p">[</span><span class="n">SLObjectConverter</span> <span class="nl">setDefaultDateTimeFormat:</span><span class="s">@&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&#39;Z&#39;&quot;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The basic setup is done and we can start implementing our first model.</p>

<h2>Implementing the user model</h2>

<p>Our first model to implement will be a user. The GithubAPI returns a specific user from the following route: <code>GET /users/:user</code> and returns a JSON object like</p>
<div class="highlight"><pre><code class="objective-c"><span class="p">{</span>
  <span class="s">&quot;login&quot;</span><span class="o">:</span> <span class="s">&quot;octocat&quot;</span><span class="p">,</span>
  <span class="s">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s">&quot;avatar_url&quot;</span><span class="o">:</span> <span class="s">&quot;https://github.com/images/error/octocat_happy.gif&quot;</span><span class="p">,</span>
  <span class="s">&quot;gravatar_id&quot;</span><span class="o">:</span> <span class="s">&quot;somehexcode&quot;</span><span class="p">,</span>
  <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;monalisa octocat&quot;</span><span class="p">,</span>
  <span class="s">&quot;company&quot;</span><span class="o">:</span> <span class="s">&quot;GitHub&quot;</span><span class="p">,</span>
  <span class="s">&quot;blog&quot;</span><span class="o">:</span> <span class="s">&quot;https://github.com/blog&quot;</span><span class="p">,</span>
  <span class="s">&quot;email&quot;</span><span class="o">:</span> <span class="s">&quot;octocat@github.com&quot;</span><span class="p">,</span>
  <span class="s">&quot;created_at&quot;</span><span class="o">:</span> <span class="s">&quot;2008-01-14T04:33:35Z&quot;</span><span class="p">,</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<p>which we want to store in the following CoreData model:</p>
<div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">GHUser</span> : <span class="nc">NSManagedObject</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSNumber</span> <span class="o">*</span><span class="n">identifier</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">login</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">avatarURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">gravatarIdentifier</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">company</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">blog</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">email</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSDate</span> <span class="o">*</span><span class="n">createdAt</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre></div>
<h3>Attribute mapping</h3>

<p>By default, SLRESTfulCoreData maps camelized objc attributes to underscored JSON object attributes. That mean for example by default <code>createdAt</code> will be mapped to <code>created_at</code>. Therefor we get the mapping for <code>login</code>, <code>name</code>, <code>company</code>, <code>blog</code>, <code>email</code> and <code>createdAt</code> for free. Custom attribute mapping can be done in the NSManagedObjctes subclasses initalizer like:</p>
<div class="highlight"><pre><code class="objective-c"><span class="k">@implementation</span> <span class="nc">GHUser</span>

<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initialize</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nl">registerAttributeMapping:</span><span class="p">(</span><span class="err">@</span><span class="p">{</span>
                                    <span class="s">@&quot;identifier&quot;</span><span class="o">:</span> <span class="s">@&quot;id&quot;</span><span class="p">,</span>
                                    <span class="s">@&quot;gravatarIdentifier&quot;</span><span class="o">:</span> <span class="s">@&quot;gravatar_id&quot;</span><span class="p">,</span>
                                    <span class="s">@&quot;avatarURL&quot;</span><span class="o">:</span> <span class="s">@&quot;avatar_url&quot;</span>
                                    <span class="p">})];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
<p>But wait? Is this DRY? Github has the convention to name all identifiers with an <code>id</code> suffix like <code>id</code> or <code>gravatar_id</code> and all URLs have an <code>url</code> suffix. We would like to introduce some conventions for our model too. If the Github API has <code>id</code> in an attribute name, we would like to automatically associate that with an <code>identifier</code> in objc. The same goes for <code>url</code> in JSON and <code>URL</code> in Objc. SLRESTfulCoreData supports these naming conventions and we can extend our Initilizer as follows:</p>
<div class="highlight"><pre><code class="objective-c"><span class="kt">void</span> <span class="nf">GHInitializeSLRESTfulCoreData</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="err">@</span><span class="n">autoreleasepool</span> <span class="p">{</span>
        <span class="p">...</span> 

        <span class="c1">// SLAttributeMapping encapsulates everything regarding attribute mappings. Each NSManagedObject subclass has with its own instance and we can register global default values here as well:</span>
        <span class="p">[</span><span class="n">SLAttributeMapping</span> <span class="nl">registerDefaultObjcNamingConvention:</span><span class="s">@&quot;identifier&quot;</span> <span class="nl">forJSONNamingConvention:</span><span class="s">@&quot;id&quot;</span><span class="p">];</span>
        <span class="p">[</span><span class="n">SLAttributeMapping</span> <span class="nl">registerDefaultObjcNamingConvention:</span><span class="s">@&quot;URL&quot;</span> <span class="nl">forJSONNamingConvention:</span><span class="s">@&quot;url&quot;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Now <code>gravatar_id</code> will be automatically mapped to <code>gravatarIdentifier</code>, <code>id</code> will be mapped to <code>identifier</code> and <code>avatar_url</code> will be mapped to <code>avatarURL</code>. We can delete <code>+[GHUser initialize]</code> entirely and nothing more is to do for <code>GHUser</code>&#39;s attribute mapping.</p>

<p>SLRESTfulCoreData also automatically type checks all attributes coming from the API to match the types defined in your CoreData model.</p>

<h3>Fetching a single user object</h3>

<p>To now fetch a user with a specific name from the Github API, we add a class method on <code>GHUser</code>:</p>
<div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">GHUser</span> : <span class="nc">NSManagedObject</span>

<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">userWithName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span> <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">GHUser</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>

<span class="k">@end</span>



<span class="k">@implementation</span> <span class="nc">GHUser</span>

<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">userWithName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span> <span class="nf">completionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">GHUser</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span>
<span class="p">{</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">URL</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">URLWithString:</span><span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;/users/%@&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">]];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nl">fetchObjectFromURL:</span><span class="n">URL</span> <span class="nl">completionHandler:</span><span class="n">completionHandler</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
<p>SLRESTfulCoreData introduces a convenience method on NSManagedObject: <code>+[NSManagedObject fetchObjectFromURL:completionHandler:]</code> which fetches a JSON object from the specific URL and updates the corresponding <code>NSManagedObject</code> with the same <code>identifier</code> or creates a new object if non with the corresponding <code>identifier</code> can be found.</p>

<p>Now fetching a user is as easy as</p>
<div class="highlight"><pre><code class="objective-c"><span class="p">[</span><span class="n">GHUser</span> <span class="nl">userWithName:</span><span class="s">@&quot;OliverLetterer&quot;</span> <span class="nl">completionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">GHUser</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">);</span>
<span class="p">}];</span>
</code></pre></div>
<p>and everything regarding the user model is encapsulated in <code>GHUser</code> class.</p>

<h2>A second model</h2>

<p>Let&#39;s setup <code>GHRepository</code> real quick:</p>
<div class="highlight"><pre><code class="json"><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1296269</span><span class="p">,</span>
    <span class="nt">&quot;owner&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;octocat&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nt">&quot;avatar_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/images/error/octocat_happy.gif&quot;</span><span class="p">,</span>
      <span class="nt">&quot;gravatar_id&quot;</span><span class="p">:</span> <span class="s2">&quot;somehexcode&quot;</span><span class="p">,</span>
      <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.github.com/users/octocat&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello-World&quot;</span><span class="p">,</span>
    <span class="nt">&quot;full_name&quot;</span><span class="p">:</span> <span class="s2">&quot;octocat/Hello-World&quot;</span><span class="p">,</span>
    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This your first repo!&quot;</span><span class="p">,</span>
    <span class="nt">&quot;private&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;fork&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.github.com/repos/octocat/Hello-World&quot;</span><span class="p">,</span>
    <span class="nt">&quot;html_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/octocat/Hello-World&quot;</span><span class="p">,</span>
    <span class="nt">&quot;clone_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/octocat/Hello-World.git&quot;</span><span class="p">,</span>
    <span class="nt">&quot;git_url&quot;</span><span class="p">:</span> <span class="s2">&quot;git://github.com/octocat/Hello-World.git&quot;</span><span class="p">,</span>
    <span class="nt">&quot;ssh_url&quot;</span><span class="p">:</span> <span class="s2">&quot;git@github.com:octocat/Hello-World.git&quot;</span><span class="p">,</span>
    <span class="nt">&quot;svn_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://svn.github.com/octocat/Hello-World&quot;</span><span class="p">,</span>
    <span class="nt">&quot;mirror_url&quot;</span><span class="p">:</span> <span class="s2">&quot;git://git.example.com/octocat/Hello-World&quot;</span><span class="p">,</span>
    <span class="nt">&quot;homepage&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com&quot;</span><span class="p">,</span>
    <span class="nt">&quot;language&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;forks&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="nt">&quot;forks_count&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="nt">&quot;watchers&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="nt">&quot;watchers_count&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">108</span><span class="p">,</span>
    <span class="nt">&quot;master_branch&quot;</span><span class="p">:</span> <span class="s2">&quot;master&quot;</span><span class="p">,</span>
    <span class="nt">&quot;open_issues&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;pushed_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-01-26T19:06:43Z&quot;</span><span class="p">,</span>
    <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-01-26T19:01:12Z&quot;</span><span class="p">,</span>
    <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-01-26T19:14:43Z&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></div><div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">GHRepository</span> : <span class="nc">NSManagedObject</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSNumber</span> <span class="o">*</span><span class="n">identifier</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">fullName</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">remoteDescription</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSNumber</span> <span class="o">*</span><span class="n">private</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSNumber</span> <span class="o">*</span><span class="n">fork</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">htmlURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">cloneURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">gitURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">sshURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">svnURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">mirrorURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">homepage</span><span class="p">;</span>
<span class="p">...</span> 

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">GHUser</span> <span class="o">*</span><span class="n">owner</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">GHRepository</span>

<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initialize</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nl">registerAttributeName:</span><span class="s">@&quot;remoteDescription&quot;</span> <span class="nl">forJSONObjectKeyPath:</span><span class="s">@&quot;description&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
<p>Since <code>description</code> has already taken by <code>NSObject</code>, we map the JSON <code>description</code> attribute to <code>remoteDescription</code> for our model.</p>

<p>Notice the to-one relationship <code>owner</code>? Since the Github API returns a user object in <code>owner</code>, SLRESTfulCoreData automatically detects the returned data and creates a new <code>GHUser</code> object accordingly (if needed). A correct object-graph is automatically created and setup for you. If the API would return an <code>owner_id</code> for a repository, the owner relation would be set if an owner with the corresponding <code>identifier</code> already exists in the database.</p>

<h2>Fetching repositories of a user</h2>

<p>GitHub provides the route <code>GET /users/:user/repos</code> for fetching repositories of a given user. SLRESTfuleCoreData extends <code>NSManagedObject</code> with <code>-[NSManagedObject fetchObjectsForRelationship:fromURL:completionHandler:]</code> for exactly that purpose. Let&#39;s first extend the relationship between our <code>GHUser</code> and <code>GHRepository</code> model on the user site:</p>
<div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">GHUser</span> : <span class="nc">NSManagedObject</span>

<span class="p">...</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSSet</span> <span class="o">*</span><span class="n">repositories</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">GHUser</span> <span class="nl">(CoreDataGeneratedAccessors)</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addRepositoriesObject:</span><span class="p">(</span><span class="n">GHRepository</span> <span class="o">*</span><span class="p">)</span><span class="nv">value</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">removeRepositoriesObject:</span><span class="p">(</span><span class="n">GHRepository</span> <span class="o">*</span><span class="p">)</span><span class="nv">value</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addRepositories:</span><span class="p">(</span><span class="n">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">values</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">removeRepositories:</span><span class="p">(</span><span class="n">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">values</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre></div>
<p>and implement a corresponding method for fetching repositories from that URL:</p>
<div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">GHUser</span> : <span class="nc">NSManagedObject</span>

<span class="p">...</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">repositoriesWithCompletionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">repositories</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="n">completionHandler</span><span class="p">;</span>

<span class="k">@end</span>



<span class="k">@implementation</span> <span class="nc">GHUser</span>

<span class="p">...</span>

<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">repositoriesWithCompletionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">repositories</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="n">completionHandler</span>
<span class="p">{</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">URL</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">URLWithString:</span><span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;/users/%@/repos&quot;</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">login</span><span class="p">]];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nl">fetchObjectsForRelationship:</span><span class="s">@&quot;repositories&quot;</span> <span class="nl">fromURL:</span><span class="n">URL</span> <span class="nl">completionHandler:</span><span class="n">completionHandler</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
<p>That&#39;s it. The object graph with <code>GHRepository</code> instances is completly and correcty setup for you. The really interesting part is that since we are using CoreData, only one instance for a user per <code>identifier</code> is beeing allocated at runtime (actually two; one on the main thread and one on the backgronud thread). Let&#39;s take a look at the following snippet:</p>
<div class="highlight"><pre><code class="objective-c"><span class="p">[</span><span class="n">GHUser</span> <span class="nl">userWithName:</span><span class="s">@&quot;OliverLetterer&quot;</span> <span class="nl">completionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">GHUser</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">user</span> <span class="nl">repositoriesWithCompletionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">repositories</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">GHRepository</span> <span class="o">*</span><span class="n">repository</span> <span class="k">in</span> <span class="n">repositories</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">repository</span><span class="p">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">user</span><span class="p">;</span> <span class="err">#</span> <span class="o">=&gt;</span> <span class="n">true</span>
        <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}];</span>
</code></pre></div>
<p>The owner of each repository in the above example is equal to the user object and can be compared with <code>==</code>.</p>

<p>SLRESTfulCoreData now provides some cool techniques to make default tasks like fetching objects and fetching objects for relationsships easier. These will be demonstrated with the <code>repositories</code> relationship of <code>GHUser</code>:</p>
<div class="highlight"><pre><code class="objective-c"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">repositoriesWithCompletionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">repositories</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span>
<span class="p">{</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">URL</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nl">URLWithString:</span><span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span><span class="s">@&quot;/users/%@/repos&quot;</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">login</span><span class="p">]];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nl">fetchObjectsForRelationship:</span><span class="s">@&quot;repositories&quot;</span> <span class="nl">fromURL:</span><span class="n">URL</span> <span class="nl">completionHandler:</span><span class="n">completionHandler</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>URL substitution:</li>
</ul>

<p>Building the corresponding URL can be quiet ugly in case you would have to worry about percent escapes and lots of values beeing substituted into the URL. Thanks to SLRESTfulCoreDatas URL substitution feature, we could also specify the URL in the above example as <code>[NSURL URLWithString:@&quot;/users/:login/repos&quot;]</code> where <code>:login</code> will be evaluated with the current <code>GHUser</code> instance. This works for full key paths and since URL naming conventions are underscored based, we would specify them here in an underscored way as well. For example the key path <code>:repository.some_user.gravatar_id</code> will be translated into the objc key path <code>repository.someUser.gravatarIdentifier</code>.</p>

<ul>
<li>Generated accessors at runtime</li>
</ul>

<p>Fetching objects for relationships in such a way seem like a repetitive task as well. Therefore, you can specify CRUD base URLs for each relationship in your initializer like:</p>
<div class="highlight"><pre><code class="objective-c"><span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initialize</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nl">registerCRUDBaseURL:</span><span class="p">[</span><span class="n">NSURL</span> <span class="nl">URLWithString:</span><span class="s">@&quot;/users/:login/repos&quot;</span><span class="p">]</span> <span class="nl">forRelationship:</span><span class="s">@&quot;repositories&quot;</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>. SLRESTfulCoreData can now implement <code>-[GHUser repositoriesWithCompletionHandler:]</code> at runtime by implementing its own version of <code>+[NSManagedObject resolveInstanceMethod:]</code>. We can remove the implementation <code>-[GHUser repositoriesWithCompletionHandler:]</code> entirely and move the definition in the <code>CoreDataGeneratedAccessors</code> category:</p>
<div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">GHUser</span> <span class="nl">(CoreDataGeneratedAccessors)</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">repositoriesWithCompletionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">repositories</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre></div>
<h2>CRUD support for models</h2>

<p>To demonstrate the last set of features, we are going to implement the issue model. Here is what the JSON the API returns for an issue:</p>
<div class="highlight"><pre><code class="json"><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.github.com/repos/octocat/Hello-World/issues/1347&quot;</span><span class="p">,</span>
    <span class="nt">&quot;html_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/octocat/Hello-World/issues/1347&quot;</span><span class="p">,</span>
    <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="mi">1347</span><span class="p">,</span>
    <span class="nt">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span>
    <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Found a bug&quot;</span><span class="p">,</span>
    <span class="nt">&quot;body&quot;</span><span class="p">:</span> <span class="s2">&quot;I&#39;m having a problem with this.&quot;</span><span class="p">,</span>
    <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;octocat&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nt">&quot;avatar_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/images/error/octocat_happy.gif&quot;</span><span class="p">,</span>
      <span class="nt">&quot;gravatar_id&quot;</span><span class="p">:</span> <span class="s2">&quot;somehexcode&quot;</span><span class="p">,</span>
      <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.github.com/users/octocat&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.github.com/repos/octocat/Hello-World/labels/bug&quot;</span><span class="p">,</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;bug&quot;</span><span class="p">,</span>
        <span class="nt">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;f29513&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;assignee&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;octocat&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nt">&quot;avatar_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/images/error/octocat_happy.gif&quot;</span><span class="p">,</span>
      <span class="nt">&quot;gravatar_id&quot;</span><span class="p">:</span> <span class="s2">&quot;somehexcode&quot;</span><span class="p">,</span>
      <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.github.com/users/octocat&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;milestone&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.github.com/repos/octocat/Hello-World/milestones/1&quot;</span><span class="p">,</span>
      <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="nt">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span>
      <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;v1.0&quot;</span><span class="p">,</span>
      <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;creator&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;octocat&quot;</span><span class="p">,</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&quot;avatar_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/images/error/octocat_happy.gif&quot;</span><span class="p">,</span>
        <span class="nt">&quot;gravatar_id&quot;</span><span class="p">:</span> <span class="s2">&quot;somehexcode&quot;</span><span class="p">,</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://api.github.com/users/octocat&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;open_issues&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="nt">&quot;closed_issues&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
      <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-04-10T20:09:31Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;due_on&quot;</span><span class="p">:</span> <span class="kc">null</span>
    <span class="p">},</span>
    <span class="nt">&quot;comments&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;pull_request&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;html_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/octocat/Hello-World/issues/1347&quot;</span><span class="p">,</span>
      <span class="nt">&quot;diff_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/octocat/Hello-World/issues/1347.diff&quot;</span><span class="p">,</span>
      <span class="nt">&quot;patch_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/octocat/Hello-World/issues/1347.patch&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;closed_at&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;created_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-04-22T13:33:48Z&quot;</span><span class="p">,</span>
    <span class="nt">&quot;updated_at&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-04-22T13:33:48Z&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<p>For simplicity, we won&#39;t implement the labels or milestones model here. Our CoreData model will look like:</p>
<div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">GHIssue</span> : <span class="nc">NSManagedObject</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSNumber</span> <span class="o">*</span><span class="n">number</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">htmlURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">state</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">title</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">body</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSNumber</span> <span class="o">*</span><span class="n">comments</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSDate</span> <span class="o">*</span><span class="n">closedAt</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSDate</span> <span class="o">*</span><span class="n">createdAt</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSDate</span> <span class="o">*</span><span class="n">updatedAt</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">GHUser</span> <span class="o">*</span><span class="n">user</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">GHUser</span> <span class="o">*</span><span class="n">assignee</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">GHRepository</span> <span class="o">*</span><span class="n">repository</span><span class="p">;</span>

<span class="k">@end</span>



<span class="k">@implementation</span> <span class="nc">GHIssue</span>

<span class="k">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initialize</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nl">registerUniqueIdentifierOfJSONObjects:</span><span class="s">@&quot;number&quot;</span><span class="p">];</span>

    <span class="p">[</span><span class="n">self</span> <span class="nl">registerCRUDBaseURL:</span><span class="p">[</span><span class="n">NSURL</span> <span class="nl">URLWithString:</span><span class="s">@&quot;/repos/:repository.full_name/issues&quot;</span><span class="p">]];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
<p>Notice two things:</p>

<ul>
<li>GitHub is not following its <code>id</code> convention so we have to register the new name <code>number</code> for the attribute holding the unique key.</li>
<li>We are registering a CRUD base URL for an issue in relation to its repository relationship with <em>underscored</em> naming conventions.</li>
</ul>

<p>This will give us multiple things:</p>

<ul>
<li>SLRESTfulCoreData provides the following methods at runtime for us:</li>
</ul>
<div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">GHRepository</span> <span class="nl">(CoreDataGeneratedAccessors)</span>

<span class="c1">// GET /repos/:self.full_name/issues</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">issuesWithCompletionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">NSArray</span> <span class="o">*</span><span class="n">issues</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>

<span class="c1">// POST /repos/:repository.full_name/issues</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">addIssuesObject:</span><span class="p">(</span><span class="n">GHIssue</span> <span class="o">*</span><span class="p">)</span><span class="nv">issue</span> <span class="nf">withCompletionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">GHIssue</span> <span class="o">*</span><span class="n">issue</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>

<span class="c1">// DELETE /repos/:repository.full_name/issues/:number</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">deleteIssuesObject:</span><span class="p">(</span><span class="n">GHIssue</span> <span class="o">*</span><span class="p">)</span><span class="nv">issue</span> <span class="nf">withCompletionHandler:</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">GHIssue</span> <span class="o">*</span><span class="n">issue</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completionHandler</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre></div>
<ul>
<li>SLRESTfulCoreData also provides the following CRUD methods for us:</li>
</ul>
<div class="highlight"><pre><code class="objective-c"><span class="n">GHIssue</span> <span class="o">*</span><span class="n">issue</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSEntityDescription</span> <span class="nl">insertNewObjectForEntityForName:</span><span class="n">NSStringFromClass</span><span class="p">([</span><span class="n">GHIssue</span> <span class="n">class</span><span class="p">])</span>
                                               <span class="nl">inManagedObjectContext:</span><span class="p">[</span><span class="n">GHDataStoreManager</span> <span class="n">sharedInstance</span><span class="p">].</span><span class="n">mainThreadContext</span><span class="p">];</span>
<span class="n">issue</span><span class="p">.</span><span class="n">number</span> <span class="o">=</span> <span class="err">@</span><span class="mi">1</span><span class="p">;</span>
<span class="n">issue</span><span class="p">.</span><span class="n">repository</span> <span class="o">=</span> <span class="p">...;</span>

<span class="c1">// GET /repos/:repository.full_name/issues/:number</span>
<span class="p">[</span><span class="n">issue</span> <span class="nl">updateWithCompletionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">GHIssue</span> <span class="o">*</span><span class="n">issue</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}];</span>

<span class="c1">// POST /repos/:repository.full_name/issues</span>
<span class="p">[</span><span class="n">issue</span> <span class="nl">createWithCompletionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">GHIssue</span> <span class="o">*</span><span class="n">issue</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}];</span>

<span class="c1">// PATCH /repos/:repository.full_name/issues/:number</span>
<span class="p">[</span><span class="n">issue</span> <span class="nl">saveWithCompletionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">GHIssue</span> <span class="o">*</span><span class="n">issue</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}];</span>

<span class="c1">// DELETE /repos/:repository.full_name/issues/:number</span>
<span class="p">[</span><span class="n">issue</span> <span class="nl">deleteWithCompletionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}];</span>
</code></pre></div>
            </article>
        </section>
    </div>
</body>
</html>